import java.util.*;public class MatrixMult {    static int CUTOFF = 64;    static double[][] add(double[][] A, double[][] B) {        int n=A.length; double[][] C=new double[n][n];        for(int i=0;i<n;i++) for(int j=0;j<n;j++) C[i][j]=A[i][j]+B[i][j];        return C;    }    static double[][] sub(double[][] A, double[][] B) {        int n=A.length; double[][] C=new double[n][n];        for(int i=0;i<n;i++) for(int j=0;j<n;j++) C[i][j]=A[i][j]-B[i][j];        return C;    }    static double[][] naive(double[][] A, double[][] B) {        int n=A.length; double[][] C=new double[n][n];        for(int i=0;i<n;i++)            for(int k=0;k<n;k++)                for(int j=0;j<n;j++)                    C[i][j]+=A[i][k]*B[k][j];        return C;    }    static double[][] strassen(double[][] A, double[][] B) {        int n=A.length;        if(n<=CUTOFF) return naive(A,B);        int m=n/2;        double[][] A11=new double[m][m],A12=new double[m][m],A21=new double[m][m],A22=new double[m][m];        double[][] B11=new double[m][m],B12=new double[m][m],B21=new double[m][m],B22=new double[m][m];        for(int i=0;i<m;i++)            for(int j=0;j<m;j++){                A11[i][j]=A[i][j];                A12[i][j]=A[i][j+m];                A21[i][j]=A[i+m][j];                A22[i][j]=A[i+m][j+m];                B11[i][j]=B[i][j];                B12[i][j]=B[i][j+m];                B21[i][j]=B[i+m][j];                B22[i][j]=B[i+m][j+m];            }        double[][] M1=strassen(add(A11,A22),add(B11,B22));        double[][] M2=strassen(add(A21,A22),B11);        double[][] M3=strassen(A11,sub(B12,B22));        double[][] M4=strassen(A22,sub(B21,B11));        double[][] M5=strassen(add(A11,A12),B22);        double[][] M6=strassen(sub(A21,A11),add(B11,B12));        double[][] M7=strassen(sub(A12,A22),add(B21,B22));        double[][] C=new double[n][n];        for(int i=0;i<m;i++)            for(int j=0;j<m;j++){                C[i][j]=M1[i][j]+M4[i][j]-M5[i][j]+M7[i][j];                C[i][j+m]=M3[i][j]+M5[i][j];                C[i+m][j]=M2[i][j]+M4[i][j];                C[i+m][j+m]=M1[i][j]+M3[i][j]-M2[i][j]+M6[i][j];            }        return C;    }    static double memMB(){        Runtime r=Runtime.getRuntime();        return (r.totalMemory()-r.freeMemory())/1024.0/1024.0;    }    public static void main(String[] args){        int n0=Integer.parseInt(args[0]);        int n=1; while(n<n0) n<<=1;        Random rnd=new Random();        double[][] A=new double[n][n],B=new double[n][n];        for(int i=0;i<n0;i++) for(int j=0;j<n0;j++){            A[i][j]=rnd.nextDouble();            B[i][j]=rnd.nextDouble();        }        System.gc();        double peak=0;        long t0=System.nanoTime();        naive(A,B);        peak=Math.max(peak,memMB());        long t1=System.nanoTime();        System.out.printf("Naive Algorithm Time: %.6f%n",(t1-t0)/1e9);        t0=System.nanoTime();        strassen(A,B);        peak=Math.max(peak,memMB());        t1=System.nanoTime();        System.out.printf("Strassen Algorithm Time: %.6f%n",(t1-t0)/1e9);        System.out.printf("Peak RAM (MB): %.2f%n",peak);    }}