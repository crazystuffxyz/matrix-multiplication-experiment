const{spawnSync:spawnSync,spawn:spawn}=require("child_process"),ExcelJS=require("exceljs"),fs=require("fs"),path=require("path"),SIZES=[128,256,512,1024],TRIALS=10,OUTPUT_FILENAME="performance_results.xlsx";function run(e,a,s={}){return spawnSync(e,a,{stdio:"inherit",shell:!0,...s})}function ensureBuilds(){console.log("Ensuring binaries exist...\n"),fs.existsSync("matrix_mult.exe")||(console.log("Building C++..."),run("g++",["-O2","matrix_mult.cpp","-o","matrix_mult.exe"])),fs.existsSync("MatrixMult.class")||(console.log("Compiling Java..."),run("javac",["MatrixMult.java"])),console.log("Building Rust (release)..."),run("cargo",["build","--release"])}const workbook=new ExcelJS.Workbook,sheet=workbook.addWorksheet("Results");sheet.columns=[{header:"Label",key:"label",width:30},{header:"Peak RAM (MB)",key:"ram",width:20},{header:"Naive (ms)",key:"naive",width:20},{header:"Strassen (ms)",key:"strassen",width:20}];const SUITES=[{name:"JavaScript",cmd:"node",args:e=>["--expose-gc","matrix_mult.js",e]},{name:"Java",cmd:"java",args:e=>["MatrixMult",e]},{name:"C++",cmd:"matrix_mult",args:e=>[e]},{name:"Rust",cmd:"cargo",args:e=>["run","--release","--quiet","--",e]},{name:"Python",cmd:"python",args:e=>["matrix_mult.py",e]}];async function runTest(e,a){return new Promise((s=>{const t=spawn(e.cmd,e.args(a),{shell:!0});let n="";t.stdout.on("data",(e=>n+=e)),t.stderr.on("data",(e=>n+=e)),t.on("close",(()=>{const e=n.match(/Naive Algorithm Time:\s*([\d.]+)/),a=n.match(/Strassen Algorithm Time:\s*([\d.]+)/),t=n.match(/Peak RAM \(MB\):\s*([\d.]+)/);s({naive:e?(1e3*parseFloat(e[1])).toFixed(3):"ERR",strassen:a?(1e3*parseFloat(a[1])).toFixed(3):"ERR",ram:t?parseFloat(t[1]).toFixed(2):"ERR"})}))}))}!async function(){ensureBuilds();for(const e of SUITES){sheet.addRow({label:e.name});for(const a of SIZES)for(let s=1;s<=10;s++){console.log(`${e.name} | ${a}x${a} | Trial ${s}`);const t=await runTest(e,a);sheet.addRow({label:`${a} Trial ${s}`,ram:t.ram,naive:t.naive,strassen:t.strassen}),await workbook.xlsx.writeFile(OUTPUT_FILENAME)}}console.log("Finished all data.")}();